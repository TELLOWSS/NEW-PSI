<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>300+ Workers Test - PSI Worker Management</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e293b;
            border-bottom: 3px solid #4f46e5;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-left: 4px solid #4f46e5;
            border-radius: 6px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
        }
        .test-result.pass {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
        }
        .test-result.fail {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
        }
        .test-result.warning {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            color: #92400e;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
        }
        button:hover {
            background: #4338ca;
        }
        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        .performance-chart {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .metric {
            display: inline-block;
            margin: 10px 20px 10px 0;
            padding: 10px 15px;
            background: #eff6ff;
            border-radius: 6px;
            font-weight: 600;
        }
        .metric-label {
            color: #64748b;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .metric-value {
            color: #1e40af;
            font-size: 24px;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”¬ PSI ê·¼ë¡œì ê´€ë¦¬ ëŒ€ëŸ‰ ë°ì´í„° í…ŒìŠ¤íŠ¸ (300+ Workers)</h1>
        
        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ ëª©ì </h2>
            <p>WorkerManagement.tsxì˜ Progressive Rendering Engineì´ 300ëª… ì´ìƒì˜ ê·¼ë¡œì ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ë•Œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.</p>
            <ul>
                <li>âœ“ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§</li>
                <li>âœ“ ë Œë”ë§ ì™„ë£Œ ì‹œê°„ ì¸¡ì •</li>
                <li>âœ“ UI ì‘ë‹µì„± í™•ì¸</li>
                <li>âœ“ Batch ë Œë”ë§ ì„±ëŠ¥ í‰ê°€</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h2>
            <button onclick="runTest(100)">100ëª… í…ŒìŠ¤íŠ¸</button>
            <button onclick="runTest(300)">300ëª… í…ŒìŠ¤íŠ¸</button>
            <button onclick="runTest(500)">500ëª… í…ŒìŠ¤íŠ¸</button>
            <button onclick="runTest(1000)">1000ëª… í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
        </div>

        <div id="results"></div>

        <div class="performance-chart">
            <h3>ì„±ëŠ¥ ë©”íŠ¸ë¦­</h3>
            <div id="metrics"></div>
        </div>

        <div class="test-section">
            <h3>Progressive Rendering ë¡œì§ ë¶„ì„</h3>
            <pre>
// WorkerManagement.tsx - Progressive Rendering Engine
const BATCH_SIZE = 5; // í”„ë ˆì„ë‹¹ ë Œë”ë§ ê°œìˆ˜

useEffect(() => {
    if (!isPrintMode) return;
    
    if (renderLimit < workersToPrint.length) {
        const timer = requestAnimationFrame(() => {
            setRenderLimit(prev => Math.min(prev + BATCH_SIZE, workersToPrint.length));
        });
        
        return () => cancelAnimationFrame(timer);
    }
}, [isPrintMode, renderLimit, workersToPrint.length]);

// 300ëª… ê¸°ì¤€:
// - ì´ í”„ë ˆì„: 300 / 5 = 60 í”„ë ˆì„
// - ì˜ˆìƒ ì‹œê°„: 60 * 16.67ms â‰ˆ 1ì´ˆ (60fps ê¸°ì¤€)
// - ì‹¤ì œ ë Œë”ë§: ë¸Œë¼ìš°ì € ì„±ëŠ¥ì— ë”°ë¼ 1-3ì´ˆ
            </pre>
        </div>
    </div>

    <script>
        let testResults = [];

        function generateMockWorkers(count) {
            const teams = ['í˜•í‹€', 'ì² ê·¼', 'ë°°ê´€', 'ì „ê¸°', 'ë„ì¥', 'ë¯¸ì¥', 'ë¹„ê³„'];
            const levels = ['ì´ˆê¸‰', 'ì¤‘ê¸‰', 'ê³ ê¸‰'];
            const names = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„'];
            
            const workers = [];
            for (let i = 0; i < count; i++) {
                workers.push({
                    id: `worker_${i}`,
                    name: `${names[i % names.length]}${String(i).padStart(3, '0')}`,
                    jobField: teams[i % teams.length],
                    safetyLevel: levels[Math.floor(Math.random() * levels.length)],
                    safetyScore: 60 + Math.floor(Math.random() * 40),
                    weakAreas: ['ì•ˆì „ëª¨ ì°©ìš©', 'ì•ˆì „í™” ì°©ìš©'][Math.floor(Math.random() * 2)]
                });
            }
            return workers;
        }

        function simulateProgressiveRendering(workerCount, batchSize = 5) {
            return new Promise((resolve) => {
                let rendered = 0;
                const startTime = performance.now();
                const frameTimes = [];
                
                function renderBatch() {
                    const frameStart = performance.now();
                    
                    // ì‹¤ì œ DOM ë Œë”ë§ ì‹œë®¬ë ˆì´ì…˜ (ê°„ë‹¨í•œ DOM ì¡°ì‘)
                    const batchEnd = Math.min(rendered + batchSize, workerCount);
                    for (let i = rendered; i < batchEnd; i++) {
                        // Simulate DOM creation
                        const div = document.createElement('div');
                        div.textContent = `Worker ${i}`;
                        // Simulate some computation
                        div.className = 'worker-card';
                    }
                    
                    rendered = batchEnd;
                    const frameTime = performance.now() - frameStart;
                    frameTimes.push(frameTime);
                    
                    if (rendered < workerCount) {
                        requestAnimationFrame(renderBatch);
                    } else {
                        const totalTime = performance.now() - startTime;
                        resolve({
                            totalTime,
                            avgFrameTime: frameTimes.reduce((a, b) => a + b, 0) / frameTimes.length,
                            maxFrameTime: Math.max(...frameTimes),
                            minFrameTime: Math.min(...frameTimes),
                            totalFrames: frameTimes.length,
                            workers: workerCount
                        });
                    }
                }
                
                renderBatch();
            });
        }

        async function runTest(workerCount) {
            const resultsDiv = document.getElementById('results');
            const metricsDiv = document.getElementById('metrics');
            
            resultsDiv.innerHTML += `<div class="test-section"><h3>ğŸ”„ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘: ${workerCount}ëª…...</h3></div>`;
            
            // Generate mock data
            const workers = generateMockWorkers(workerCount);
            
            // Run simulation
            const result = await simulateProgressiveRendering(workerCount);
            
            // Analyze results
            const isPass = result.totalTime < 5000; // 5ì´ˆ ì´ë‚´ ì™„ë£Œ ê¸°ì¤€
            const isWarning = result.totalTime >= 3000 && result.totalTime < 5000;
            
            const testResultClass = isPass ? (isWarning ? 'warning' : 'pass') : 'fail';
            const testStatus = isPass ? (isWarning ? 'âš ï¸ ê²½ê³ ' : 'âœ… í†µê³¼') : 'âŒ ì‹¤íŒ¨';
            
            testResults.push({
                workerCount,
                ...result,
                status: testStatus
            });
            
            // Display result
            resultsDiv.innerHTML += `
                <div class="test-result ${testResultClass}">
                    <h4>${testStatus} - ${workerCount}ëª… ê·¼ë¡œì ë Œë”ë§ í…ŒìŠ¤íŠ¸</h4>
                    <p><strong>ì´ ë Œë”ë§ ì‹œê°„:</strong> ${result.totalTime.toFixed(2)}ms (${(result.totalTime / 1000).toFixed(2)}ì´ˆ)</p>
                    <p><strong>í‰ê·  í”„ë ˆì„ ì‹œê°„:</strong> ${result.avgFrameTime.toFixed(2)}ms</p>
                    <p><strong>ìµœëŒ€ í”„ë ˆì„ ì‹œê°„:</strong> ${result.maxFrameTime.toFixed(2)}ms</p>
                    <p><strong>ìµœì†Œ í”„ë ˆì„ ì‹œê°„:</strong> ${result.minFrameTime.toFixed(2)}ms</p>
                    <p><strong>ì´ í”„ë ˆì„ ìˆ˜:</strong> ${result.totalFrames} (ë°°ì¹˜ í¬ê¸°: 5)</p>
                    <p><strong>ì˜ˆìƒ FPS:</strong> ${(1000 / result.avgFrameTime).toFixed(1)} fps</p>
                    ${result.totalTime > 3000 ? '<p><strong>âš ï¸ ê¶Œì¥ì‚¬í•­:</strong> 3ì´ˆ ì´ìƒ ì†Œìš”. Batch Size ì¡°ì • ë˜ëŠ” ê°€ìƒ ìŠ¤í¬ë¡¤ ë„ì… ê¶Œì¥</p>' : ''}
                </div>
            `;
            
            // Update metrics
            updateMetrics();
        }

        function updateMetrics() {
            const metricsDiv = document.getElementById('metrics');
            if (testResults.length === 0) {
                metricsDiv.innerHTML = '<p>ì•„ì§ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.status.includes('âœ…')).length;
            const avgTime = testResults.reduce((sum, r) => sum + r.totalTime, 0) / totalTests;
            const maxWorkers = Math.max(...testResults.map(r => r.workerCount));
            
            metricsDiv.innerHTML = `
                <div class="metric">
                    <div class="metric-label">ì´ í…ŒìŠ¤íŠ¸</div>
                    <div class="metric-value">${totalTests}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">í†µê³¼ìœ¨</div>
                    <div class="metric-value">${((passedTests / totalTests) * 100).toFixed(0)}%</div>
                </div>
                <div class="metric">
                    <div class="metric-label">í‰ê·  ë Œë”ë§ ì‹œê°„</div>
                    <div class="metric-value">${(avgTime / 1000).toFixed(2)}ì´ˆ</div>
                </div>
                <div class="metric">
                    <div class="metric-label">ìµœëŒ€ í…ŒìŠ¤íŠ¸ ì¸ì›</div>
                    <div class="metric-value">${maxWorkers}ëª…</div>
                </div>
            `;
        }

        function clearResults() {
            testResults = [];
            document.getElementById('results').innerHTML = '';
            document.getElementById('metrics').innerHTML = '';
        }

        // Initial message
        document.getElementById('results').innerHTML = `
            <div class="test-section">
                <h3>â„¹ï¸ í…ŒìŠ¤íŠ¸ ì‹œì‘</h3>
                <p>ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‹¤ì–‘í•œ ì¸ì› ìˆ˜ì— ëŒ€í•œ ë Œë”ë§ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</p>
                <p><strong>ê¸°ì¤€:</strong></p>
                <ul>
                    <li>âœ… í†µê³¼: 5ì´ˆ ì´ë‚´ ì™„ë£Œ</li>
                    <li>âš ï¸ ê²½ê³ : 3-5ì´ˆ ì†Œìš” (ìµœì í™” ê¶Œì¥)</li>
                    <li>âŒ ì‹¤íŒ¨: 5ì´ˆ ì´ˆê³¼ (ì¦‰ì‹œ ê°œì„  í•„ìš”)</li>
                </ul>
            </div>
        `;
    </script>
</body>
</html>
